<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registration | IST International Winter Webinar Series</title>
  <meta name="description" content="Registration page for IST International Winter Webinar Series (Online)." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --ou-blue: #0a4da2;
      --ist-teal: #00a3a3;
      --ink: #0f172a;
      --muted: #94a3b8;
      --bg: #0b1220;
      --card: #101826;
      --ring: rgba(255,255,255,.15);
      --grad-1: #0b1220;
      --grad-2: #0f274e;
      --grad-3: #162d68;
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;padding:0;
      background:linear-gradient(135deg,var(--grad-1),var(--grad-2) 35%,var(--grad-3));
      color:#e5e7eb;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    a{color:#c7e1ff;text-decoration:none}
    img{max-width:100%;display:block;border-radius:12px}
    .container{width:min(1200px,92vw);margin-inline:auto}
    header{
      position:sticky;top:0;z-index:40;
      background:rgba(11,18,32,.8);
      backdrop-filter: blur(12px);
      border-bottom:1px solid var(--ring)
    }
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;gap:14px;align-items:center}
    .brand img{height:50px;width:auto;}
    .brand h1{
      font-family:"Playfair Display",serif;
      font-size:18px;line-height:1.1;margin:0;color:#ffffff
    }
    .brand p{margin:0;font-size:12px;color:#cbd5e1}
    .nav a.btn{padding:10px 16px;border:1px solid var(--ring);border-radius:12px}
    .btn-primary{background:linear-gradient(180deg,#3ba1ff,#1f78ff);color:#fff;border:none}
    .btn-ghost{color:#e5e7eb}

    main{padding:34px 0 40px}
    .page-title{
      font-family:"Playfair Display",serif;
      font-weight:700;
      font-size:clamp(26px,3vw,38px);
      margin:0 0 10px;
    }
    .page-sub{margin:0 0 18px;color:#cbd5e1;max-width:80ch;line-height:1.6}

    .card{
      background:var(--card);
      border:1px solid var(--ring);
      border-radius:20px;
      overflow:hidden;
      box-shadow:0 12px 30px rgba(0,0,0,.25);
    }
    .card-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:16px 16px 12px;
      border-bottom:1px solid var(--ring);
      flex-wrap:wrap;
    }
    .actions{display:flex;gap:10px;flex-wrap:wrap}

    /* form */
    .form-wrap{padding:16px}
    form{display:grid;gap:14px;max-width:900px}
    label{display:block;margin-bottom:6px;color:#e5e7eb;font-weight:600}
    .req{color:#93c5fd}
    input[type="text"], input[type="email"], select, textarea{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.15);
      background:rgba(255,255,255,.04);
      color:#e5e7eb;
      outline:none;
    }
    textarea{min-height:90px;resize:vertical}
    input::placeholder, textarea::placeholder{color:#94a3b8}
    .row-2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width: 720px){
      .row-2{grid-template-columns:1fr}
    }
    .checks{display:grid;gap:8px}
    .check{
      display:flex;gap:10px;align-items:flex-start;
      padding:10px 12px;border:1px solid rgba(255,255,255,.12);
      border-radius:12px;background:rgba(255,255,255,.03);
    }
    .check input{margin-top:3px}
    .muted{color:#cbd5e1;font-size:14px;line-height:1.6}
    .btn{
      display:inline-block;
      padding:12px 18px;
      border-radius:12px;
      border:1px solid var(--ring);
      cursor:pointer;
      user-select:none;
      font-weight:600;
    }
    .btn[disabled]{opacity:.6;cursor:not-allowed}

    /* message */
    .msg{
      margin-top:8px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.05);
      color:#cbd5e1;
      line-height:1.5;
      display:none;
    }
    .msg.ok{display:block;background:rgba(34,197,94,.16);border-color:rgba(34,197,94,.35);color:#d1fae5}
    .msg.err{display:block;background:rgba(239,68,68,.16);border-color:rgba(239,68,68,.35);color:#fee2e2}
    .msg.info{display:block;background:rgba(59,130,246,.14);border-color:rgba(59,130,246,.35);color:#dbeafe}

    footer{border-top:1px solid var(--ring);padding:30px 0 40px;color:#cbd5e1;text-align:center}
  </style>
</head>

<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <img src="assets/osaka-university-logo.png" alt="Osaka University Logo" />
        <img src="assets/ist-logo.png" alt="Graduate School of IST Logo" />
        <div>
          <h1>Winter School · Trustworthy & Generative AI for Society 5.0 (Online)</h1>
          <p>Graduate School of Information Science and Technology — Osaka University</p>
        </div>
      </div>
      <nav style="display:flex;gap:10px">
        <a class="btn btn-ghost" href="index.html">Home</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <h2 class="page-title">Registration</h2>
    <p class="page-sub">
      Participation is free, but registration is required. After submitting the form, your information will be stored in our registration sheet
      and you will receive event access information by email (if enabled by the organizer).
    </p>

    <section class="card">
      <div class="card-head">
        <strong>Registration Form</strong>
        <div class="actions">
          <a class="btn btn-ghost" href="index.html">Back to Home</a>
        </div>
      </div>

      <div class="form-wrap">
        <p class="muted" style="margin-top:0">
          Fields marked with <span class="req">*</span> are required.
        </p>

        <form id="regForm" novalidate>
          <!-- Honeypot (anti-spam). Must remain empty -->
          <input type="text" name="website" autocomplete="off" tabindex="-1"
                 style="position:absolute;left:-9999px;opacity:0;height:0;width:0" />

          <div class="row-2">
            <div>
              <label for="full_name">Full Name <span class="req">*</span></label>
              <input id="full_name" name="full_name" type="text" placeholder="e.g., Jane Doe" required />
            </div>

            <div>
              <label for="email">Email Address <span class="req">*</span></label>
              <input id="email" name="email" type="email" placeholder="name@university.edu" required />
            </div>
          </div>

          <div class="row-2">
            <div>
              <label for="country">Country / Region <span class="req">*</span></label>
              <input id="country" name="country" type="text" placeholder="e.g., Japan" required />
            </div>

            <div>
              <label for="position">Academic Status / Position <span class="req">*</span></label>
              <select id="position" name="position" required>
                <option value="" selected disabled>Select…</option>
                <option>Undergraduate Student</option>
                <option>Master’s Student</option>
                <option>Ph.D. Student</option>
                <option>Postdoctoral Researcher</option>
                <option>Faculty Member</option>
                <option>Industry Researcher / Engineer</option>
                <option>Other</option>
              </select>
            </div>
          </div>

          <div>
            <label for="university">University / Institution Name <span class="req">*</span></label>
            <input id="university" name="university" type="text" placeholder="e.g., The University of Osaka" required />
          </div>

          <div>
            <label for="department">Department / School</label>
            <input id="department" name="department" type="text" placeholder="e.g., Information Science and Technology" />
          </div>

          <div>
            <label>Lectures of Interest</label>
            <div class="checks">
              <label class="check"><input type="checkbox" name="lectures_interest" value="Talk 1: Millimeter-level Wireless Localization Using UWB Wireless Networks"> <span>Talk 1: Millimeter-level Wireless Localization Using UWB Wireless Networks</span></label>
              <label class="check"><input type="checkbox" name="lectures_interest" value="Talk 2: Engineering of Metabolic Pathways and Controlling the Flux for Efficient Bio-Production"> <span>Talk 2: Engineering of Metabolic Pathways and Controlling the Flux for Efficient Bio-Production</span></label>
              <label class="check"><input type="checkbox" name="lectures_interest" value="Talk 3: Detection of Hardware Trojans in Integrated Circuits"> <span>Talk 3: Detection of Hardware Trojans in Integrated Circuits</span></label>
              <label class="check"><input type="checkbox" name="lectures_interest" value="Talk 4: Distributed Algorithm Beyond Worst Case"> <span>Talk 4: Distributed Algorithm Beyond Worst Case</span></label>
              <label class="check"><input type="checkbox" name="lectures_interest" value="Talk 5: Graph Data Analysis: From Efficiency and Accuracy to Trustworthy"> <span>Talk 5: Graph Data Analysis: From Efficiency and Accuracy to Trustworthy</span></label>
            </div>
            <p class="muted" style="margin-bottom:0">Optional — you can attend multiple sessions.</p>
          </div>

          <div>
            <label for="heard_from">How did you hear about this event?</label>
            <select id="heard_from" name="heard_from">
              <option value="" selected disabled>Select…</option>
              <option>University website</option>
              <option>Email announcement</option>
              <option>Colleague / Supervisor</option>
              <option>Social media</option>
              <option>Other</option>
            </select>
          </div>

          <div>
            <label for="notes">Notes / Accessibility Requirements</label>
            <textarea id="notes" name="notes" placeholder="Optional (e.g., captions, materials in advance)"></textarea>
          </div>

          <div class="check">
            <input id="consent" name="consent" type="checkbox" required />
            <label for="consent" style="margin:0;font-weight:500">
              I agree that my registration information will be used only for event organization and communication related to this webinar series.
              <span class="req">*</span>
            </label>
          </div>

          <div class="check">
            <input id="recording" name="recording" type="checkbox" required />
            <label for="recording" style="margin:0;font-weight:500">
              I understand that sessions may be recorded for academic and educational purposes. <span class="req">*</span>
            </label>
          </div>

          <button class="btn btn-primary" type="submit" id="submitBtn">
            Submit Registration
          </button>

          <!-- ✅ Message box (was missing in your original page) -->
          <div id="msg" class="msg" role="status" aria-live="polite"></div>
        </form>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; <span id="year"></span> Graduate School of Information Science and Technology, Osaka University. All rights reserved.</p>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // =========================================
    // BACKEND CONFIG
    // =========================================
    // Put your Apps Script Web App URL here (must end with /exec).
    // Example: https://script.google.com/macros/s/AKfycb.../exec
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbx58Yy8x-sgFn_KjKtAn_4F5KYIdufQDI418UT740rz3GWLY8wHvZeTAa1wZQvTzuI/exec";

    // If your Apps Script DOES NOT set CORS headers, GitHub Pages cannot read the response.
    // In that case, set USE_NO_CORS = true (you still can submit, but can't read JSON back).
    const USE_NO_CORS = true;

    function getCheckedValues(form, name) {
      return [...form.querySelectorAll(`input[name="${name}"]:checked`)].map(x => x.value);
    }

    function setMsg(text, kind) {
      const el = document.getElementById("msg");
      if (!el) return; // safety

      el.textContent = text;
      el.className = "msg " + (kind || "info");
      // ensure visible by applying one of the classes
      if (!kind) el.className = "msg info";
      el.scrollIntoView({ behavior: "smooth", block: "nearest" });
    }

    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    document.getElementById("regForm").addEventListener("submit", async (ev) => {
      ev.preventDefault();

      if (!ENDPOINT || ENDPOINT.includes("PASTE_YOUR_APPS_SCRIPT_WEB_APP_URL_HERE")) {
        setMsg("❌ Organizer setup incomplete: Apps Script endpoint is not set yet.", "err");
        return;
      }

      const form = ev.target;
      const submitBtn = document.getElementById("submitBtn");

      // Honeypot: if filled, silently succeed (avoid tipping bots)
      if ((form.website?.value || "").trim() !== "") {
        setMsg("✅ Registration submitted successfully. Thank you!", "ok");
        form.reset();
        return;
      }

      // Basic front-end validation
      if (!form.full_name.value.trim() || !form.email.value.trim() || !form.country.value.trim()
          || !form.university.value.trim() || !form.position.value) {
        setMsg("❌ Please fill all required fields.", "err");
        return;
      }
      if (!isValidEmail(form.email.value.trim())) {
        setMsg("❌ Please enter a valid email address.", "err");
        return;
      }
      if (!form.consent.checked || !form.recording.checked) {
        setMsg("❌ Please accept the consent and recording notices.", "err");
        return;
      }

      submitBtn.disabled = true;
      setMsg("Submitting…", "info");

      const payload = {
        full_name: form.full_name.value.trim(),
        email: form.email.value.trim(),
        country: form.country.value.trim(),
        university: form.university.value.trim(),
        department: form.department.value.trim(),
        position: form.position.value,
        lectures_interest: getCheckedValues(form, "lectures_interest"),
        heard_from: form.heard_from.value || "",
        notes: form.notes.value.trim(),
        consent: form.consent.checked ? "yes" : "no",
        recording: form.recording.checked ? "yes" : "no",
        website: form.website.value || "", // honeypot
        page_url: window.location.href,
        user_agent: navigator.userAgent,
        submitted_at: new Date().toISOString()
      };

      try {
        const fetchOptions = {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        };

        // no-cors mode: request can be sent, but response is opaque (can't read JSON/status).
        if (USE_NO_CORS) {
          fetchOptions.mode = "no-cors";
        }

        const res = await fetch(ENDPOINT, fetchOptions);

        if (USE_NO_CORS) {
          // We cannot verify response body; treat "no exception" as success.
          setMsg("✅ Registration submitted successfully. Thank you!", "ok");
          form.reset();
          return;
        }

        const data = await res.json().catch(() => ({}));

        if (!res.ok || data.ok !== true) {
          throw new Error(data.error || `Submit failed (${res.status})`);
        }

        setMsg("✅ Registration submitted successfully. Thank you!", "ok");
        form.reset();
      } catch (err) {
        setMsg("❌ Error: " + (err?.message || "Unknown error") + " — please try again later.", "err");
        console.error(err);
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
